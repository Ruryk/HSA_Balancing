# HSA_Balancing

## Load Balancer

- Set up load balancer on nginx that will have 1 server for UK, 2 servers for US, and 1 server for the rest.
- In case of failure, it should send all traffic to backup server.
- Health check should happen every 5 seconds.
- *Please use ngrok and touch vpn chrome extension.

## Run the Project

````bash
docker-compose up --build
````

## Run the Ngrok

````bash
ngrok http http://localhost:8086
````

## Testing the Load Balancer

- Use VPN: Enable the Touch VPN Chrome extension or any other VPN tool and switch between different regions (UK, US,
  etc.).
- Ngrok URL: Visit the public URL generated by Ngrok (e.g., http://<ngrok_url>) to access the load balancer and check
  which regional server is handling your request.

## Headers for Debugging

You can also verify the region and server handling your request by inspecting the response headers:

- X-Region-Code: This header shows the country code of the region handling the request.
- X-Region-Server: This header shows the server that processed the request.

## Failover Testing

To test how the load balancer handles failures:

- Stop a Server: You can stop any specific server using the following Docker command:

````bash
docker stop <container_id>
````

Replace <container_id> with the actual ID of the server container (you can find the ID with docker ps).

- Backup Server: After stopping the main server, re-run the test and check if the load balancer forwards the traffic to
  the backup server. You can check this by inspecting the X-Region-Server header or page that says "Backup Server".
